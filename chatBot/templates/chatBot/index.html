<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Projexis Bot + Chat</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.css"/>

  <!-- HTMX for Chat -->
  <script src="https://unpkg.com/htmx.org@1.9.4" integrity="sha384-zUfuhFKKZCbHTY6aRR46gxiqszMk5tcHjsVFxnUo8VMus4kHGVdIYVbOYYNlKmHV" crossorigin="anonymous"></script>

  <style>
    :root {
      --beige: #E8E1DA;
      --orange: #FEB856;
      --text-dark: #333;
      --white: #fff;
    }

    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--beige);
      color: var(--text-dark);
      margin: 0;
      padding: 0;
    }

    h1, h2 {
      text-align: center;
      color: var(--text-dark);
    }

    section {
      background-color: var(--white);
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      margin: 30px auto;
      padding: 30px 20px;
      width: 90%;
      max-width: 900px;
    }

    input[type="text"], input[type='text'][name='message'] {
      padding: 0.6rem;
      width: 80%;
      max-width: 400px;
      margin-bottom: 15px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }

    button, input[type="submit"] {
      background-color: var(--orange);
      color: var(--white);
      border: none;
      padding: 0.6rem 1.2rem;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      transition: background-color 0.2s ease;
    }

    button:hover, input[type="submit"]:hover {
      background-color: #e39e42;
    }

    #map {
      width: 100%;
      height: 400px;
      border-radius: 12px;
      margin-top: 20px;
    }

    .swiper {
      width: 100%;
      padding: 20px 0;
    }

    .swiper-slide {
      background: var(--beige);
      border-radius: 12px;
      text-align: center;
      padding: 10px;
      height: auto;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }

    .swiper-slide img {
      width: 100%;
      border-radius: 8px;
    }

    .swiper-slide p {
      margin-top: 5px;
      font-weight: 600;
      font-size: 0.95em;
    }

    /* Chat Styles */
    .my-indicator {
      display: none;
      border: 2px solid #f3f3f3;
      border-top: 2px solid #3498db;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      animation: spin 0.5s linear infinite;
    }

    .htmx-request .my-indicator {
      display: inline-block;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .user-message { color: #b83eff; padding: 5px; }
    .bot-message { color: darkblue; padding: 5px; }

    #chatbox {
      margin-top: 15px;
      padding: 10px;
      background-color: #f9f9f9;
      border-radius: 10px;
    }
  </style>
</head>
<body>

  <!-- Welcome Section -->
  <section>
    <h1>Welcome to Projexis</h1>
    <p>Brainstorm your next creative project with our bot. Once you're ready, we’ll help you make it real!</p>
    <p>If you already have an idea, skip the chat and go straight to the resources!</p>
  </section>

  <!-- Chatbot Section  make sure u do "pip install openai" in ur terminal so it works--> 
  <section>
    <h2>Chat with the Projexis Bot</h2>
    <div id="container">
      {% include 'chatbox.html' %}
      <form
        hx-post="{% url 'chat_view' %}"
        hx-target="#chatbox"
        hx-swap="innerHTML"
        hx-on="htmx:afterRequest: this.reset()"
      >
        {% csrf_token %}
        <div class="my-indicator"></div>
        <div class="input-fields">
          <input type="text" name="message" />
          <button type="submit">Send</button>
        </div>
      </form>
    </div>
  </section>

  <!-- Project Idea -->
  <section>
    <h2>What’s Your Craft Idea?</h2>
    <form id="ideaForm">
      <input type="text" id="idea" name="idea" placeholder="e.g., Crochet coasters" required />
      <br />
      <input type="submit" value="Find YouTube Tutorials" />
    </form>
  </section>

  <!-- YouTube Videos -->
  <section id="video-section" style="display:none;">
    <h2>Video Tutorials for Your Idea</h2>
    <div class="swiper">
      <div class="swiper-wrapper" id="video-carousel"></div>
      <div class="swiper-button-next"></div>
      <div class="swiper-button-prev"></div>
    </div>
  </section>

  <!-- Store Locator -->
  <section>
    <h2>Where to Buy Materials</h2>
    <form id="locationForm">
      <input type="text" id="zip" placeholder="Enter your city or zip code" required />
      <br />
      <button type="submit">Search Craft Stores Near You</button>
    </form>
    <div id="map"></div>
  </section>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.js"></script>
  <script>
    // YouTube API handler
    document.getElementById('ideaForm').addEventListener('submit', async function (e) {
      e.preventDefault();
      const idea = document.getElementById('idea').value;
      const response = await fetch(`/chatBot/api/youtube/?q=${encodeURIComponent(idea)}`);
      const data = await response.json();
      const container = document.getElementById("video-carousel");
      container.innerHTML = "";

      if (data.videos && data.videos.length > 0) {
        data.videos.forEach(video => {
          const slide = document.createElement("div");
          slide.className = "swiper-slide";
          slide.innerHTML = `
            <a href="https://www.youtube.com/watch?v=${video.videoId}" target="_blank">
              <img src="${video.thumbnail}" alt="${video.title}" />
              <p>${video.title}</p>
            </a>`;
          container.appendChild(slide);
        });

        document.getElementById('video-section').style.display = 'block';

        new Swiper('.swiper', {
          slidesPerView: 2.5,
          spaceBetween: 15,
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
          },
          breakpoints: {
            0: { slidesPerView: 1 },
            600: { slidesPerView: 1.5 },
            900: { slidesPerView: 2.5 }
          }
        });
      } else {
        container.innerHTML = "<p>No tutorials found. Try a different idea!</p>";
        document.getElementById('video-section').style.display = 'block';
      }
    });

    // Google Maps Store Search
    document.getElementById('locationForm').addEventListener('submit', function (e) {
      e.preventDefault();
      const address = document.getElementById('zip').value;
      const geocoder = new google.maps.Geocoder();

      geocoder.geocode({ address: address }, function (results, status) {
        if (status === 'OK') {
          const userLocation = results[0].geometry.location;
          const map = new google.maps.Map(document.getElementById("map"), {
            center: userLocation,
            zoom: 13,
          });

          const request = {
            location: userLocation,
            radius: '5000',
            keyword: 'craft store',
          };

          const service = new google.maps.places.PlacesService(map);
          service.nearbySearch(request, function (results, status) {
            if (status === google.maps.places.PlacesServiceStatus.OK) {
              results.forEach(place => {
                new google.maps.Marker({
                  map,
                  position: place.geometry.location,
                  title: place.name,
                });
              });
            }
          });
        } else {
          alert('Could not find that location: ' + status);
        }
      });
    });
  </script>

  <script async
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCseiFgaYDtfR-9L3MvAnWlnl1aOyLqYs0&libraries=places">
  </script>
</body>
</html>
